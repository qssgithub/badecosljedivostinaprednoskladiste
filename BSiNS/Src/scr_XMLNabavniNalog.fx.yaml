"scr_XMLNabavniNalog As screen.'autoLayout_HeaderFooter_ver1.0'":
    Fill: =RGBA(234, 83, 109, 1)
    LoadingSpinnerColor: =RGBA(164, 38, 44, 1)
    OnVisible: |
        =Set(isLoading, true);
        
        Reset(nabavniNalogReadyForNavCheckbox);
        UpdateContext({scannedItem: Blank()});
        If(!IsBlank(SelectedFile),
            IfError(GetXML_Nabavni_Nalog.Run(SelectedFile, SelectedFolder),
                Notify("Error occurred while Get request, check if file exists.",NotificationType.Error,5000),
                UpdateContext({purchase: GetXML_Nabavni_Nalog.Run(SelectedFile, SelectedFolder)})
            );
        
            UpdateContext({purchase_line: purchase.purchase_line});
            UpdateContext({purchase_header: ParseJSON(purchase.purchase_header)});
        
            Clear(colPurchaseLines);
            ForAll(
                ParseJSON(purchase_line),
                Collect(
                    colPurchaseLines,
                    {
                        Document_Type: Text(ThisRecord.Document_Type),
                        'Buy-from_Vendor_No.': Text(ThisRecord.'Buy-from_Vendor_No.'),
                        Document_No: Text(ThisRecord.Document_No),
                        Line_No: Text(ThisRecord.Line_No),
                        Type: Text(ThisRecord.Type),
                        Item_No: Text(ThisRecord.Item_No),
                        Location_Code: Text(ThisRecord.Location_Code),
                        Posting_Group: Text(ThisRecord.Posting_Group),
                        Description: Text(ThisRecord.Description),
                        Unit_Of_Measure: Text(ThisRecord.Unit_Of_Measure),
                        Quantity: Text(ThisRecord.Quantity),
                        LOT_No: Text(ThisRecord.LOT_No),
                        Exp_Date: Text(ThisRecord.Exp_Date)
                    }
                );
            );
        
            ClearCollect(colOriginalPurchaseLines, colPurchaseLines);
        );
        
        Set(isLoading, false);

    NabavniNalogScreenContainer As groupContainer.verticalAutoLayoutContainer:
        DropShadow: =DropShadow.Light
        Fill: =RGBA(245, 245, 245, 1)
        Height: =Parent.Height
        LayoutAlignItems: =LayoutAlignItems.Stretch
        LayoutDirection: =LayoutDirection.Vertical
        LayoutGap: =16
        LayoutMode: =LayoutMode.Auto
        RadiusBottomLeft: =4
        RadiusBottomRight: =4
        RadiusTopLeft: =4
        RadiusTopRight: =4
        Width: =Parent.Width
        ZIndex: =1

        NabavniNalogHeader As Header:
            BasePaletteColor: =RGBA(249, 83, 109, 1)
            DisplayMode: =DisplayMode.Edit
            FontColor: =
            Height: =75
            LayoutMinHeight: =75
            LayoutMinWidth: =Parent.Width
            Logo: =FFLogo
            OnSelectLogo: =Navigate(scrEntry)
            Style: ='Header.Style'.Primary
            Title: ="NABAVNI NALOG"
            UserEmail: =User().Email
            UserImage: =User().Image
            UserName: =User().FullName
            Width: =Parent.Width
            X: =0
            Y: =0
            ZIndex: =1

        NabavniNalogDataContainer As groupContainer.manualLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            DropShadow: =DropShadow.Light
            Height: =565
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            RadiusBottomLeft: =4
            RadiusBottomRight: =4
            RadiusTopLeft: =4
            RadiusTopRight: =4
            Visible: =!isLoading
            Width: =Parent.Width
            X: =6
            Y: =15
            ZIndex: =2

            "PurchaseItemsGallery As gallery.'BrowseLayout_Vertical_OneTextVariant_ver5.0'":
                BorderColor: =RGBA(89, 0, 0, 1)
                BorderThickness: =0.5
                Default: |
                    =If(!IsBlank(scannedItem),First(Filter(colPurchaseLines, ThisRecord.Line_No = Text(scannedItem))), First(colPurchaseLines))
                DelayItemLoading: =true
                Height: =375
                Items: =colPurchaseLines
                Layout: =Layout.Vertical
                LoadingSpinner: =LoadingSpinner.Data
                TemplatePadding: =0
                TemplateSize: =194
                Visible: =false
                Width: =1284
                X: =28
                Y: =169
                ZIndex: =1

                Separator1 As rectangle:
                    BorderColor: =RGBA(89, 0, 0, 1)
                    BorderThickness: =0.5
                    Fill: =RGBA(189, 49, 51, 1)
                    Height: =2
                    OnSelect: =Select(Parent)
                    Width: =Parent.TemplateWidth
                    Y: =Parent.TemplateHeight - Self.Height
                    ZIndex: =3

                Rectangle1 As rectangle:
                    BorderColor: =RGBA(89, 0, 0, 1)
                    Fill: =RGBA(89, 0, 0, 1)
                    Height: =Parent.TemplateHeight - Separator1.Height
                    OnSelect: =Select(Parent)
                    Visible: =ThisItem.IsSelected
                    Width: =4
                    ZIndex: =4

                Group9 As group:
                    Height: =5
                    Width: =5
                    X: =60
                    Y: =60
                    ZIndex: =46

                    Label2_20 As label:
                        Align: =Align.Center
                        BorderColor: =RGBA(89, 0, 0, 1)
                        BorderThickness: =0.5
                        Color: =RGBA(0, 0, 0, 1)
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        Height: =23
                        OnSelect: =Select(Parent)
                        PaddingBottom: =10
                        PaddingLeft: =0
                        Size: =13
                        Text: ="Quantity"
                        Width: =124
                        X: =1130
                        Y: =17
                        ZIndex: =30

                    "QuantityVal As 'Text input'":
                        Align: ='TextInputCanvas.Align'.Center
                        BasePaletteColor: =
                        DisplayMode: =DisplayMode.Edit
                        FontColor: =
                        Height: =31
                        OnChange: |-
                            =UpdateIf(colPurchaseLines, PurchaseItemsGallery.Selected.Item_No = ThisRecord.Item_No ,{Quantity: Value(QuantityVal.Value)})
                        Value: =ThisItem.Quantity
                        Width: =124
                        X: =1130
                        Y: =39
                        ZIndex: =41

            Container6 As groupContainer.verticalAutoLayoutContainer:
                DropShadow: =DropShadow.Light
                Height: =Parent.Height
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMode: =LayoutMode.Auto
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                Width: =Parent.Width
                ZIndex: =25

                "NabavniNalogLines As gallery.'BrowseLayout_Vertical_ThreeTextVariant_ver5.0'":
                    BorderColor: =RGBA(89, 0, 0, 1)
                    DelayItemLoading: =true
                    Height: =Parent.Height
                    Items: =colPurchaseLines
                    Layout: =Layout.Vertical
                    LayoutMinHeight: =287
                    LayoutMinWidth: =320
                    LoadingSpinner: =LoadingSpinner.Data
                    TemplatePadding: =0
                    TemplateSize: =116
                    Width: =Parent.Width
                    ZIndex: =1

                    Title5 As label:
                        Color: =RGBA(50, 49, 48, 1)
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                        Height: =Self.Size * 1.8
                        OnSelect: =Select(Parent)
                        PaddingBottom: =0
                        PaddingLeft: =0
                        PaddingRight: =0
                        PaddingTop: =0
                        Text: =ThisItem.'Buy-from_Vendor_No.'
                        VerticalAlign: =VerticalAlign.Top
                        Width: =Parent.TemplateWidth - 86
                        X: =16
                        Y: =(Parent.TemplateHeight - (Self.Size*1.8 + Subtitle4.Size*1.8 + 2 + Body1.Size*1.8)) / 2
                        ZIndex: =1

                    Subtitle4 As label:
                        Color: =RGBA(0, 0, 0, 1)
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                        Height: =Self.Size * 1.8
                        OnSelect: =Select(Parent)
                        PaddingBottom: =0
                        PaddingLeft: =0
                        PaddingRight: =0
                        PaddingTop: =0
                        Size: =12
                        Text: =ThisItem.Description
                        VerticalAlign: =VerticalAlign.Top
                        Width: =Title5.Width
                        X: =Title5.X
                        Y: =Title5.Y + Title5.Height
                        ZIndex: =2

                    Body1 As label:
                        Color: =RGBA(0, 0, 0, 1)
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
                        Height: =Self.Size * 1.8
                        OnSelect: =Select(Parent)
                        PaddingBottom: =0
                        PaddingLeft: =0
                        PaddingRight: =0
                        PaddingTop: =0
                        Size: =12
                        Text: =ThisItem.Document_No
                        VerticalAlign: =VerticalAlign.Top
                        Width: =Title5.Width
                        X: =Title5.X
                        Y: =Subtitle4.Y + Subtitle4.Height
                        ZIndex: =3

                    NextArrow5 As icon.ChevronRight:
                        AccessibleLabel: =Self.Tooltip
                        BorderColor: =RGBA(89, 0, 0, 1)
                        Color: =RGBA(166, 166, 166, 1)
                        DisabledBorderColor: =RGBA(166, 166, 166, 1)
                        DisabledColor: =RGBA(244, 244, 244, 1)
                        Height: =50
                        Icon: =Icon.ChevronRight
                        OnSelect: =Select(Parent)
                        PaddingBottom: =16
                        PaddingLeft: =16
                        PaddingRight: =16
                        PaddingTop: =16
                        Tooltip: ="View item details"
                        Width: =50
                        X: =Parent.TemplateWidth - Self.Width - 12
                        Y: =(Parent.TemplateHeight / 2) - (Self.Height / 2)
                        ZIndex: =4

                    Separator6 As rectangle:
                        BorderColor: =RGBA(89, 0, 0, 1)
                        Fill: =RGBA(255, 255, 255, 1)
                        Height: =8
                        OnSelect: =Select(Parent)
                        Width: =Parent.TemplateWidth
                        Y: =Parent.TemplateHeight - Self.Height
                        ZIndex: =5

                    Rectangle5 As rectangle:
                        BorderColor: =RGBA(89, 0, 0, 1)
                        Fill: =RGBA(89, 0, 0, 1)
                        Height: =Parent.TemplateHeight - Separator6.Height
                        OnSelect: =Select(Parent)
                        Visible: =ThisItem.IsSelected
                        Width: =4
                        ZIndex: =6

        Spinner2_1 As Spinner:
            AlignInContainer: =AlignInContainer.Stretch
            BasePaletteColor: =RGBA(249, 83, 109, 1)
            DisplayMode: =DisplayMode.Edit
            FillPortions: =1
            FontColor: =
            Height: =200
            LayoutMinHeight: =200
            LayoutMinWidth: =200
            SpinnerSize: ='Spinner.SpinnerSize'.Huge
            Visible: =isLoading
            Width: =200
            X: =0
            Y: =0
            ZIndex: =3

        NabavniNalogFooterContainer As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            BorderColor: =RGBA(233, 79, 76, 1)
            DropShadow: =DropShadow.Light
            Fill: =RGBA(237, 237, 237, 1)
            Height: =50
            LayoutMinHeight: =50
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            RadiusBottomLeft: =8
            RadiusBottomRight: =8
            RadiusTopLeft: =8
            RadiusTopRight: =8
            Visible: =false
            Width: =1335
            ZIndex: =4

            Button6_2 As button:
                DisabledBorderColor: =RGBA(166, 166, 166, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                Fill: =RGBA(164, 38, 44, 1)
                FontWeight: =FontWeight.Semibold
                Height: =50
                HoverColor: =RGBA(255, 255, 255, 1)
                HoverFill: =ColorFade(RGBA(164, 38, 44, 1), -20%)
                OnSelect: =Set(varShowGetFileModal,true);
                Size: =15
                Text: ="Get xml by name"
                ZIndex: =1

            Button6 As button:
                DisabledBorderColor: =RGBA(166, 166, 166, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                Fill: =RGBA(164, 38, 44, 1)
                FontWeight: =FontWeight.Semibold
                Height: =50
                HoverColor: =RGBA(255, 255, 255, 1)
                HoverFill: =ColorFade(RGBA(164, 38, 44, 1), -20%)
                OnSelect: |-
                    =Set(purchase_header, Blank());
                    Clear(colPurchaseLines);
                Size: =15
                Text: ="Clear view"
                ZIndex: =4

            Button6_24 As button:
                DisabledBorderColor: =RGBA(166, 166, 166, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(244, 244, 244, 1)
                Fill: =RGBA(164, 38, 44, 1)
                FontWeight: =FontWeight.Semibold
                Height: =50
                HoverColor: =RGBA(255, 255, 255, 1)
                HoverFill: =ColorFade(RGBA(164, 38, 44, 1), -20%)
                OnSelect: |-
                    =ClearCollect(colPurchaseLines, colOriginalPurchaseLines);
                    Reset(nabavniNalogReadyForNavCheckbox);
                Size: =15
                Text: ="Reset"
                ZIndex: =5

            nabavniNalogReadyForNavCheckbox As Checkbox:
                BasePaletteColor: =RGBA(249, 83, 109, 1)
                DisplayMode: =DisplayMode.Edit
                FontColor: =
                FontSize: =14
                FontWeight: =FontWeight.Bold
                Height: =Parent.Height
                Label: ="Ready for NAV"
                LayoutMinHeight: =32
                LayoutMinWidth: =160
                OnCheck: =false
                OnUncheck: =false
                Width: =160
                X: =0
                Y: =0
                ZIndex: =6

            "BarcodeReader1 As 'Barcode Reader'":
                BarcodeType: ='BarcodeReader.BarcodeType'.Code128
                BorderFillColor: =RGBA(233, 79, 76, 1)
                DisabledBorderColor: =RGBA(166, 166, 166, 1)
                DisabledContentColor: =RGBA(166, 166, 166, 1)
                DisabledFillColor: =RGBA(244, 244, 244, 1)
                DisplayMode: =DisplayMode.Edit
                FillColor: =RGBA(204, 74, 57, 1)
                FontSize: =15
                Height: =Parent.Height
                HoverBorderColor: =RGBA(189, 49, 51, 1)
                HoverContentColor: =RGBA(255, 255, 255, 1)
                HoverFillColor: =RGBA(189, 49, 51, 1)
                LayoutMinHeight: =70
                LayoutMinWidth: =280
                OnCancel: =false
                OnScan: |-
                    =UpdateContext({
                        scannedItem:First(BarcodeReader1.Barcodes).Value
                    })
                PressedBorderColor: =RGBA(189, 49, 51, 1)
                PressedContentColor: =RGBA(189, 49, 51, 1)
                PressedFillColor: =RGBA(255, 255, 255, 1)
                ScanningMode: ='BarcodeReader.ScanningMode'.SelectToScan
                Text: ="Scan"
                TextColor: =RGBA(255, 255, 255, 1)
                Width: =100
                X: =0
                Y: =0
                ZIndex: =7

    saveXml As button:
        DisabledBorderColor: =RGBA(166, 166, 166, 1)
        DisabledColor: =RGBA(166, 166, 166, 1)
        DisabledFill: =RGBA(244, 244, 244, 1)
        DisplayMode: |-
            =//If(!IsBlank(purchase_header) || !IsBlank(purchase_line), DisplayMode.Edit, DisplayMode.Disabled)
            DisplayMode.Edit
        Fill: =RGBA(164, 38, 44, 1)
        FontWeight: =FontWeight.Semibold
        Height: =50
        HoverColor: =RGBA(255, 255, 255, 1)
        HoverFill: =ColorFade(RGBA(164, 38, 44, 1), -20%)
        OnSelect: |+
            =UpdateContext({
                purchaseJsonData:
                JSON(
                    {
                        Purchase_Header: {
                            Document_Type: Text(purchase_header.Document_Type),
                            'Buy-from_Vendor_No.': Text(purchase_header.'Buy-from_Vendor_No.'),
                            'No.': Text(purchase_header.'No.'),
                            'Ship-to_Code': Text(purchase_header.'Ship-to_Code'),
                            'Ship-to_Name': Text(purchase_header.'Ship-to_Name'),
                            'Ship-to_Name_2': Text(purchase_header.'Ship-to_Name_2'),
                            'Ship-to_Address': Text(purchase_header.'Ship-to_Address'),
                            'Ship-to_Address_2': Text(purchase_header.'Ship-to_Address_2'),
                            'Ship-to_City': Text(purchase_header.'Ship-to_City'),
                            'Ship-to_Contact': Text(purchase_header.'Ship-to_Contact'),
                            Order_Date: Text(purchase_header.Order_Date),
                            Expected_Receipt_Date: Text(purchase_header.Expected_Receipt_Date),
                            Due_Date: Text(purchase_header.Due_Date),
                            Shipment_Method_Code: Text(purchase_header.Shipment_Method_Code),
                            Location_Code: Text(purchase_header.Location_Code),
                            Vendor_Posting_Group: Text(purchase_header.Vendor_Posting_Group),
                            Currency_Code: Text(purchase_header.Currency_Code),
                            Language_Code: Text(purchase_header.Language_Code),
                            Purchaser_Code: Text(purchase_header.Purchaser_Code),
                            Amount: Text(purchase_header.Amount),
                            Amount_Including_VAT: Text(purchase_header.Amount_Including_VAT),
                            'Vendor_Order_No.': Text(purchase_header.'Vendor_Order_No.'),
                            'Vendor_Shipment_No.': Text(purchase_header.'Vendor_Shipment_No.'),
                            'Vendor_Invoice_No.': Text(purchase_header.'Vendor_Invoice_No.'),
                            'VAT_Registration_No.': Text(purchase_header.VAT_Registration_No),
                            Gen_Bus_Posting_Group: Text(purchase_header.Gen_Bus_Posting_Group),
                            Transport_Method: Text(purchase_header.Transport_Method),
                            VAT_Country_Code: Text(purchase_header.VAT_Country_Code),
                            'Buy-from_Vendor_Name': Text(purchase_header.'Buy-from_Vendor_Name'),
                            'Buy-from_Vendor_Name_2': Text(purchase_header.'Buy-from_Vendor_Name_2'),
                            'Buy-from_Address': Text(purchase_header.'Buy-from_Address'),
                            'Buy-from_Address_2': Text(purchase_header.'Buy-from_Address_2'),
                            'Buy-from_City': Text(purchase_header.'Buy-from_City'),
                            'Buy-from_Contact': Text(purchase_header.'Buy-from_Contact'),
                            'Buy-from_Post_Code': Text(purchase_header.'Buy-from_Post_Code'),
                            'Buy-from_County': Text(purchase_header.'Buy-from_County'),
                            'Buy-from_Country_Code': Text(purchase_header.'Buy-from_Country_Code'),
                            'Ship-to_Post_Code': Text(purchase_header.'Ship-to_Post_Code'),
                            'Ship-to_County': Text(purchase_header.'Ship-to_County'),
                            'Ship-to_Country_Code': Text(purchase_header.'Ship-to_Country_Code'),
                            Document_Date: Text(purchase_header.Document_Date),
                            Area: Text(purchase_header.Area),
                            Tax_Area_Code: Text(purchase_header.Tax_Area_Code),
                            VAT_Bus_Posting_Group: Text(purchase_header.'VAT_Bus._Posting_Group'),
                            Status: Text(purchase_header.Status),
                            'Campaign_No.': Text(purchase_header.'Campaign_No.'),
                            'Buy-from_Contact_No.': Text(purchase_header.'Buy-from_Contact_No.'),
                            Requested_Receipt_Date: Text(purchase_header.Requested_Receipt_Date),
                            Promised_Receipt_Date: Text(purchase_header.Promised_Receipt_Date),
                            Purchase_Line: ForAll(colPurchaseLines,{
                                'Buy-from_Vendor_No.': Text('Buy-from_Vendor_No.'),
                                Description: Text(Description),
                                Document_No:Text(Document_No),
                                Document_Type:Text(Document_Type),
                                Exp_Date:Text(Exp_Date),
                                Item_No:Text(Item_No),
                                LOT_No:Text(LOT_No),
                                Line_No:Text(Line_No),
                                Location_Code:Text(Location_Code),
                                Posting_Group:Text(Posting_Group),
                                Quantity:Text(Quantity),
                                Type:Text(Type),
                                Unit_Of_Measure:Text(Unit_Of_Measure)
                            })
                        }
                    },JSONFormat.IgnoreUnsupportedTypes
                )
            });
            
            UpdateContext({responseMessage: UpdateXML.Run(purchaseJsonData, SelectedFile, SelectedFolder, nabavniNalogReadyForNavCheckbox.Checked)});
            
            //UpdateContext({parsedResponse : ParseJSON(responseMessage.response)});
            
            Navigate(scrEntry,ScreenTransition.Fade);
            
            //Notify(parsedResponse.Message , If(parsedResponse.Status = "200", NotificationType.Success, NotificationType.Error), 2000);
            
        Size: =15
        Text: ="Save"
        Visible: =false
        Width: =225
        X: =543
        Y: =704
        ZIndex: =15

